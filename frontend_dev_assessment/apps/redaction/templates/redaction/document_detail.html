{% extends "redaction/base.html" %}

{% block title %}{{ document.title }} - PDF Redaction Tool{% endblock %}

{% block content %}
<div class="flex flex-col lg:flex-row gap-6">
	<!-- ================================================================ -->
	<!-- LEFT PANEL: PDF Viewer with Redaction Tools                      -->
	<!-- ================================================================ -->
	<div id="pdf-signals" class="flex-1 bg-white rounded-lg shadow-md p-6">
		
		<!-- Document Header -->
		<div class="mb-4 flex items-center justify-between">
			<h2 class="text-xl font-bold text-gray-800">{{ document.title }}</h2>
			<a href="{% url 'redaction:document_list' %}"
			   class="text-blue-600 hover:text-blue-800 text-sm">
				&larr; Back to Documents
			</a>
		</div>

		<!-- PDF Viewer Container with DataStar Signals -->
		<!-- Signals store: redaction type, coordinates, and selections -->
		<div id="pdf-viewer-container"
		     class="border border-gray-300 rounded-lg overflow-auto bg-gray-50"
		     style="min-height: 600px"
		     data-signals="{
				type: 'text', 
				coordinates: {
					x: 0, 
					y: 0, 
					width: 0, 
					height: 0, 
					page: 1, 
					selections: []
				}
			}">
			
			<!-- Mode Toggle Buttons -->
			{% include "redaction/mode_selector.html" %}
			
			<!-- PDF Rendering Area -->
			<div class="p-4"
			     data-on-signal-patch="renderPage(patch.coordinates.page)"
			     data-on-signal-patch-filter="{include: /^coordinates\.page$/, exclude: /^(_fetching|type)$/}">
				
				<!-- Loading Indicator -->
				{% include "redaction/pdf_loader.html" %}
				
				<!-- PDF Canvas and Interactive Layers -->
				<div id="pdf-container" class="pdfViewer relative">
					
					<!-- Base PDF Canvas -->
					<canvas id="pdf" class="mx-auto border border-gray-300"></canvas>
					
					<!-- Redaction Overlays Layer -->
					<!-- Shows all existing redactions as black boxes -->
					{% include "redaction/redaction_layer.html" %}
					
					<!-- Text Selection Layer -->
					<!-- Visible only in 'text' mode for selecting text to redact -->
					{% include "redaction/text_layer.html" with document=document %}
					
					<!-- Drawing Canvas Layer -->
					<!-- Visible only in 'area' mode for drawing rectangles to redact -->
					{% include "redaction/drawing_canvas.html" with document=document %}
					
				</div>

				<!-- Page Navigation Controls -->
				{% include "redaction/pagination.html" %}
				
				<!-- PDF.js Initialization and Event Handlers -->
				{% include "redaction/pdf_scripts.html" %}
			</div>
		</div>

		<!-- Download Button -->
		<div class="mt-4">
			<a href="{% url 'redaction:document_download' document.pk %}"
			   class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded transition-colors">
				ðŸ“¥ Download Redacted PDF
			</a>
		</div>
	</div>

	<!-- ================================================================ -->
	<!-- RIGHT PANEL: Redactions List Sidebar                             -->
	<!-- ================================================================ -->
	<div class="w-full lg:w-80 bg-white rounded-lg shadow-md p-6">
		<h3 class="text-lg font-bold text-gray-800 mb-4">Redactions</h3>

		<!-- Redaction Count Display -->
		<div class="text-sm text-gray-600 mb-4">
			<p>
				Total:
				<span id="redaction-count" class="font-semibold">{{ redactions.count }}</span>
			</p>
		</div>
		
		<!-- List of Redactions -->
		{% include "redaction/redaction_list.html" %}
	</div>
</div>

<!-- Help Section with Documentation Links -->
{% include "redaction/help_section.html" %}

{% endblock %}